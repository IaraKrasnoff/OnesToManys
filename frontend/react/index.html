<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iara's Orders Management - React</title>
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Styles -->
    <style>
        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .app-header {
            background: linear-gradient(135deg, #ff7b42 0%, #ff69b4 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .app-header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .app-header .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        /* Stats Bar */
        .stats-bar {
            display: flex;
            justify-content: space-around;
            background: rgba(255,255,255,0.2);
            padding: 20px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
            margin-top: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-label {
            display: block;
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .stat-value {
            display: block;
            font-size: 1.8em;
            font-weight: bold;
        }

        /* Navigation */
        .tab-nav {
            display: flex;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            overflow: hidden;
        }

        .tab-button {
            flex: 1;
            padding: 15px 20px;
            background: white;
            border: none;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab-button:hover {
            background: #f8f9fa;
        }

        .tab-button.active {
            background: #ff7b42;
            color: white;
            border-bottom-color: #ffd700;
        }

        /* Content Area */
        .content-area {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            min-height: 600px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .section-header h2 {
            color: #495057;
            font-size: 1.8em;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn i {
            margin-right: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ff7b42 0%, #ff69b4 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 123, 66, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .btn-sm {
            padding: 5px 10px;
            font-size: 0.9em;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        .data-table th {
            background: linear-gradient(135deg, #ff7b42 0%, #ff69b4 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .data-table tr:hover td {
            background-color: #f8f9fa;
        }

        .data-table tr:nth-child(even) {
            background-color: #f8f9fb;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .modal-header {
            background: linear-gradient(135deg, #ff7b42 0%, #ff69b4 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 10px 10px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
        }

        .modal-body {
            padding: 30px;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #495057;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 5px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #ff7b42;
            box-shadow: 0 0 0 3px rgba(255, 123, 66, 0.1);
        }

        .form-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .loading i {
            font-size: 2em;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Error */
        .error {
            text-align: center;
            padding: 40px;
            color: #dc3545;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #28a745;
            color: white;
            padding: 15px 20px;
            border-radius: 5px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1500;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.error {
            background: #dc3545;
        }

        /* Analytics */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .analytics-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .analytics-card h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .product-stats {
            max-height: 300px;
            overflow-y: auto;
        }

        .product-stat {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: white;
            margin-bottom: 5px;
            border-radius: 5px;
            border-left: 4px solid #ff7b42;
        }

        /* Order with Items Form Styles */
        .order-with-items-form {
            max-width: 800px;
        }

        .form-section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #ff7b42;
        }

        .form-section h4 {
            margin-bottom: 15px;
            color: #495057;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .items-container {
            max-height: 400px;
            overflow-y: auto;
        }

        .item-row {
            display: grid;
            grid-template-columns: 2fr 120px 140px 140px 40px;
            gap: 15px;
            align-items: end;
            padding: 15px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .item-row .form-group {
            margin-bottom: 0;
        }

        .product-dropdown {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        .product-dropdown:focus {
            outline: none;
            border-color: #ff7b42;
            box-shadow: 0 0 0 2px rgba(255, 123, 66, 0.2);
        }

        .price-display {
            font-weight: bold;
            color: #28a745;
            font-size: 1.1em;
            padding: 8px 12px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            text-align: center;
        }

        .line-total {
            font-weight: bold;
            color: #28a745;
            font-size: 1.1em;
            display: block;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 4px;
            text-align: center;
        }

        .remove-item-btn {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            width: 35px;
            height: 35px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: background-color 0.2s ease;
        }

        .remove-item-btn:hover {
            background: #c82333;
        }

        .order-summary {
            text-align: right;
            padding: 20px;
            background: #e9ecef;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 1.3em;
            color: #495057;
        }

        /* Responsive adjustments for order form */
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .item-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .item-row .form-group label {
                font-weight: bold;
                margin-bottom: 5px;
                display: block;
            }

            .product-dropdown {
                font-size: 16px; /* Prevent zoom on iOS */
            }
        }

        /* Order Details Styles */
        .order-item-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            margin: 8px 0;
            border-radius: 8px;
            border-left: 4px solid #ff7b42;
            transition: all 0.2s ease;
        }

        .order-item-row:hover {
            background: #e9ecef;
        }

        .item-info {
            flex: 1;
        }

        .item-main {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .item-details {
            color: #6c757d;
            font-size: 0.9em;
        }

        .edit-quantity {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .quantity-input {
            width: 60px;
            padding: 4px 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .quantity-input:focus {
            outline: none;
            border-color: #ff7b42;
            box-shadow: 0 0 0 2px rgba(255, 123, 66, 0.2);
        }

        .item-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .item-total {
            font-weight: bold;
            color: #28a745;
            font-size: 1.1em;
            min-width: 80px;
            text-align: right;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .btn-xs {
            padding: 5px 8px;
            font-size: 12px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-xs:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .btn-xs.btn-success {
            background: #28a745;
            color: white;
        }

        .btn-xs.btn-success:hover {
            background: #218838;
        }

        .btn-xs.btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-xs.btn-warning:hover {
            background: #e0a800;
        }

        .btn-xs.btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-xs.btn-danger:hover {
            background: #c82333;
        }

        .btn-xs.btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-xs.btn-secondary:hover {
            background: #5a6268;
        }

        /* Responsive styles for order details */
        @media (max-width: 768px) {
            .order-item-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .item-actions {
                align-self: stretch;
                justify-content: space-between;
            }

            .action-buttons {
                gap: 8px;
            }
        }

    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // API Configuration
        const API_BASE_URL = 'http://localhost:8000';

        // API Helper Function
        const apiCall = async (endpoint, options = {}) => {
            try {
                const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || `HTTP ${response.status}: ${response.statusText}`);
                }

                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        };

        // Toast Component
        const Toast = ({ message, type, isVisible, onClose }) => {
            useEffect(() => {
                if (isVisible) {
                    const timer = setTimeout(onClose, 3000);
                    return () => clearTimeout(timer);
                }
            }, [isVisible, onClose]);

            if (!isVisible) return null;

            return (
                <div className={`toast ${type} show`}>
                    {message}
                </div>
            );
        };

        // Modal Component
        const Modal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                        <div className="modal-header">
                            <h3>{title}</h3>
                            <button className="modal-close" onClick={onClose}>&times;</button>
                        </div>
                        <div className="modal-body">
                            {children}
                        </div>
                    </div>
                </div>
            );
        };

        // Order Form Component
        const OrderForm = ({ order, onSave, onCancel }) => {
            const [formData, setFormData] = useState({
                customer_id: order?.customer_id || '',
                order_date: order?.order_date || new Date().toISOString().split('T')[0]
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave({
                    ...formData,
                    customer_id: parseInt(formData.customer_id)
                });
            };

            const handleChange = (e) => {
                setFormData({
                    ...formData,
                    [e.target.name]: e.target.value
                });
            };

            return (
                <form onSubmit={handleSubmit}>
                    <div className="form-group">
                        <label htmlFor="customer_id">Customer ID:</label>
                        <input
                            type="number"
                            id="customer_id"
                            name="customer_id"
                            value={formData.customer_id}
                            onChange={handleChange}
                            required
                        />
                    </div>
                    <div className="form-group">
                        <label htmlFor="order_date">Order Date:</label>
                        <input
                            type="date"
                            id="order_date"
                            name="order_date"
                            value={formData.order_date}
                            onChange={handleChange}
                            required
                        />
                    </div>
                    <div className="form-buttons">
                        <button type="button" className="btn btn-secondary" onClick={onCancel}>
                            Cancel
                        </button>
                        <button type="submit" className="btn btn-primary">
                            {order ? 'Update Order' : 'Create Order'}
                        </button>
                    </div>
                </form>
            );
        };

        // Item Form Component
        const ItemForm = ({ item, onSave, onCancel }) => {
            const [formData, setFormData] = useState({
                order_id: item?.order_id || '',
                product_id: item?.product_id || '',
                quantity: item?.quantity || '',
                unit_price: item?.unit_price || ''
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave({
                    order_id: parseInt(formData.order_id),
                    product_id: parseInt(formData.product_id),
                    quantity: parseInt(formData.quantity),
                    unit_price: parseFloat(formData.unit_price)
                });
            };

            const handleChange = (e) => {
                setFormData({
                    ...formData,
                    [e.target.name]: e.target.value
                });
            };

            return (
                <form onSubmit={handleSubmit}>
                    <div className="form-group">
                        <label htmlFor="order_id">Order ID:</label>
                        <input
                            type="number"
                            id="order_id"
                            name="order_id"
                            value={formData.order_id}
                            onChange={handleChange}
                            required
                        />
                    </div>
                    <div className="form-group">
                        <label htmlFor="product_id">Product ID:</label>
                        <input
                            type="number"
                            id="product_id"
                            name="product_id"
                            value={formData.product_id}
                            onChange={handleChange}
                            required
                        />
                    </div>
                    <div className="form-group">
                        <label htmlFor="quantity">Quantity:</label>
                        <input
                            type="number"
                            id="quantity"
                            name="quantity"
                            value={formData.quantity}
                            onChange={handleChange}
                            min="1"
                            required
                        />
                    </div>
                    <div className="form-group">
                        <label htmlFor="unit_price">Unit Price:</label>
                        <input
                            type="number"
                            id="unit_price"
                            name="unit_price"
                            value={formData.unit_price}
                            onChange={handleChange}
                            step="0.01"
                            min="0"
                            required
                        />
                    </div>
                    <div className="form-buttons">
                        <button type="button" className="btn btn-secondary" onClick={onCancel}>
                            Cancel
                        </button>
                        <button type="submit" className="btn btn-primary">
                            {item ? 'Update Item' : 'Create Item'}
                        </button>
                    </div>
                </form>
            );
        };

        // Order with Items Form Component (Atomic Transaction)
        const OrderWithItemsForm = ({ onSave, onCancel, showToast }) => {
            // Available products with their prices
            const availableProducts = [
                { id: 1001, name: 'Laptop Pro', price: 999.99 },
                { id: 2001, name: 'Wireless Headphones', price: 159.99 },
                { id: 2002, name: 'Smart Watch', price: 299.99 },
                { id: 501, name: 'USB Cable', price: 15.99 },
                { id: 1002, name: 'Gaming Mouse', price: 79.99 },
                { id: 1003, name: 'Mechanical Keyboard', price: 129.99 },
                { id: 3001, name: 'Tablet', price: 449.99 },
                { id: 3002, name: 'Phone Case', price: 24.99 }
            ];

            const [orderData, setOrderData] = useState({
                customer_id: '',
                order_date: new Date().toISOString().split('T')[0]
            });

            const [items, setItems] = useState([
                { product_id: '', quantity: 1, unit_price: 0 }
            ]);

            const [orderTotal, setOrderTotal] = useState(0);

            // Calculate total whenever items change
            useEffect(() => {
                const total = items.reduce((sum, item) => {
                    const lineTotal = (item.quantity || 0) * (item.unit_price || 0);
                    return sum + lineTotal;
                }, 0);
                setOrderTotal(total);
            }, [items]);

            const handleOrderChange = (e) => {
                setOrderData({
                    ...orderData,
                    [e.target.name]: e.target.value
                });
            };

            const handleItemChange = (index, field, value) => {
                const updatedItems = [...items];
                
                if (field === 'product_id') {
                    // When product changes, automatically set the price
                    const selectedProduct = availableProducts.find(p => p.id === parseInt(value));
                    updatedItems[index] = {
                        ...updatedItems[index],
                        product_id: value,
                        unit_price: selectedProduct ? selectedProduct.price : 0
                    };
                } else if (field === 'quantity') {
                    updatedItems[index] = {
                        ...updatedItems[index],
                        [field]: parseInt(value) || 0
                    };
                } else {
                    updatedItems[index] = {
                        ...updatedItems[index],
                        [field]: value
                    };
                }
                
                setItems(updatedItems);
            };

            const addItem = () => {
                setItems([...items, { product_id: '', quantity: 1, unit_price: 0 }]);
            };

            const removeItem = (index) => {
                if (items.length > 1) {
                    setItems(items.filter((_, i) => i !== index));
                }
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                
                // Validate order data
                if (!orderData.customer_id || !orderData.order_date) {
                    showToast('Please fill in all order details', 'error');
                    return;
                }

                // Validate items
                const validItems = items.filter(item => 
                    item.product_id && item.quantity > 0 && item.unit_price > 0
                );

                if (validItems.length === 0) {
                    showToast('Please add at least one valid item', 'error');
                    return;
                }

                // Prepare data for atomic creation
                const orderWithItems = {
                    customer_id: parseInt(orderData.customer_id),
                    order_date: orderData.order_date,
                    items: validItems.map(item => ({
                        product_id: parseInt(item.product_id),
                        quantity: parseInt(item.quantity),
                        unit_price: parseFloat(item.unit_price)
                    }))
                };

                onSave(orderWithItems);
            };

            return (
                <div className="order-with-items-form">
                    <form onSubmit={handleSubmit}>
                        {/* Order Details Section */}
                        <div className="form-section">
                            <h4><i className="fas fa-file-invoice"></i> Order Details</h4>
                            <div className="form-row">
                                <div className="form-group">
                                    <label htmlFor="customer_id">Customer ID:</label>
                                    <input
                                        type="number"
                                        id="customer_id"
                                        name="customer_id"
                                        value={orderData.customer_id}
                                        onChange={handleOrderChange}
                                        required
                                    />
                                </div>
                                <div className="form-group">
                                    <label htmlFor="order_date">Order Date:</label>
                                    <input
                                        type="date"
                                        id="order_date"
                                        name="order_date"
                                        value={orderData.order_date}
                                        onChange={handleOrderChange}
                                        required
                                    />
                                </div>
                            </div>
                        </div>

                        {/* Items Section */}
                        <div className="form-section">
                            <div className="section-header">
                                <h4><i className="fas fa-list"></i> Order Items</h4>
                                <button type="button" className="btn btn-sm btn-primary" onClick={addItem}>
                                    <i className="fas fa-plus"></i> Add Item
                                </button>
                            </div>

                            <div className="items-container">
                                {items.map((item, index) => {
                                    const selectedProduct = availableProducts.find(p => p.id === parseInt(item.product_id));
                                    
                                    return (
                                        <div key={index} className="item-row">
                                            <div className="form-group">
                                                <label>Product:</label>
                                                <select
                                                    value={item.product_id}
                                                    onChange={(e) => handleItemChange(index, 'product_id', e.target.value)}
                                                    required
                                                    className="product-dropdown"
                                                >
                                                    <option value="">Select a product...</option>
                                                    {availableProducts.map(product => (
                                                        <option key={product.id} value={product.id}>
                                                            {product.id} - {product.name} (${product.price})
                                                        </option>
                                                    ))}
                                                </select>
                                            </div>
                                            
                                            <div className="form-group">
                                                <label>Quantity:</label>
                                                <input
                                                    type="number"
                                                    value={item.quantity}
                                                    onChange={(e) => handleItemChange(index, 'quantity', e.target.value)}
                                                    min="1"
                                                    required
                                                />
                                            </div>

                                            <div className="form-group">
                                                <label>Unit Price:</label>
                                                <div className="price-display">
                                                    ${item.unit_price ? item.unit_price.toFixed(2) : '0.00'}
                                                </div>
                                            </div>

                                            <div className="form-group">
                                                <label>Line Total:</label>
                                                <span className="line-total">
                                                    ${((item.quantity || 0) * (item.unit_price || 0)).toFixed(2)}
                                                </span>
                                            </div>

                                            {items.length > 1 && (
                                                <button 
                                                    type="button" 
                                                    className="remove-item-btn"
                                                    onClick={() => removeItem(index)}
                                                    title="Remove Item"
                                                >
                                                    <i className="fas fa-times"></i>
                                                </button>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>

                            <div className="order-summary">
                                <strong>Total: ${orderTotal.toFixed(2)}</strong>
                            </div>
                        </div>

                        {/* Action Buttons */}
                        <div className="form-buttons">
                            <button type="button" className="btn btn-secondary" onClick={onCancel}>
                                Cancel
                            </button>
                            <button type="submit" className="btn btn-success">
                                <i className="fas fa-save"></i> Create Order
                            </button>
                        </div>
                    </form>
                </div>
            );
        };

        // Orders Table Component
        const OrdersTable = ({ orders, onDelete, onViewDetails }) => (
            <div className="table-container">
                <table className="data-table">
                    <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Customer ID</th>
                            <th>Order Date</th>
                            <th>Total Amount</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {orders.map(order => (
                            <tr key={order.order_id}>
                                <td>#{order.order_id}</td>
                                <td>{order.customer_id}</td>
                                <td>{new Date(order.order_date).toLocaleDateString()}</td>
                                <td>${order.total_amount.toFixed(2)}</td>
                                <td>
                                    <div className="action-buttons">
                                        <button 
                                            className="btn btn-sm btn-primary"
                                            onClick={() => onViewDetails(order.order_id)}
                                        >
                                            <i className="fas fa-eye"></i> Details
                                        </button>
                                        <button 
                                            className="btn btn-sm btn-danger"
                                            onClick={() => onDelete(order.order_id)}
                                        >
                                            <i className="fas fa-trash"></i> Delete
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>
        );

        // Items Table Component
        const ItemsTable = ({ items, onEdit, onDelete }) => (
            <div className="table-container">
                <table className="data-table">
                    <thead>
                        <tr>
                            <th>Item ID</th>
                            <th>Order ID</th>
                            <th>Product ID</th>
                            <th>Quantity</th>
                            <th>Unit Price</th>
                            <th>Line Total</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {items.map(item => (
                            <tr key={item.order_item_id}>
                                <td>#{item.order_item_id}</td>
                                <td>#{item.order_id}</td>
                                <td>#{item.product_id}</td>
                                <td>{item.quantity}</td>
                                <td>${item.unit_price.toFixed(2)}</td>
                                <td>${item.line_total.toFixed(2)}</td>
                                <td>
                                    <div className="action-buttons">
                                        <button 
                                            className="btn btn-sm btn-warning"
                                            onClick={() => onEdit(item)}
                                        >
                                            <i className="fas fa-edit"></i> Edit
                                        </button>
                                        <button 
                                            className="btn btn-sm btn-danger"
                                            onClick={() => onDelete(item.order_item_id)}
                                        >
                                            <i className="fas fa-trash"></i> Delete
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>
        );

        // Order Details Component
        const OrderDetails = ({ orderId, onClose, showToast, onRefresh }) => {
            const [order, setOrder] = useState(null);
            const [summary, setSummary] = useState(null);
            const [loading, setLoading] = useState(true);
            const [editingItem, setEditingItem] = useState(null);
            const [editQuantity, setEditQuantity] = useState(1);

            const loadOrderDetails = async () => {
                try {
                    const [orderData, summaryData] = await Promise.all([
                        apiCall(`/orders/${orderId}/`),
                        apiCall(`/orders/${orderId}/summary/`)
                    ]);
                    setOrder(orderData);
                    setSummary(summaryData);
                } catch (error) {
                    console.error('Failed to load order details:', error);
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                loadOrderDetails();
            }, [orderId]);

            const handleEditItem = (item) => {
                setEditingItem(item.order_item_id);
                setEditQuantity(item.quantity);
            };

            const handleSaveEdit = async (itemId) => {
                try {
                    await apiCall(`/order-items/${itemId}`, {
                        method: 'PUT',
                        body: JSON.stringify({
                            quantity: parseInt(editQuantity)
                        })
                    });
                    
                    showToast('Item quantity updated successfully!');
                    setEditingItem(null);
                    await loadOrderDetails();
                    if (onRefresh) onRefresh(); // Refresh parent data
                } catch (error) {
                    showToast('Failed to update item', 'error');
                }
            };

            const handleCancelEdit = () => {
                setEditingItem(null);
                setEditQuantity(1);
            };

            const handleDeleteItem = async (itemId) => {
                if (window.confirm('Are you sure you want to delete this item?')) {
                    try {
                        await apiCall(`/order-items/${itemId}`, { method: 'DELETE' });
                        showToast('Item deleted successfully!');
                        await loadOrderDetails();
                        if (onRefresh) onRefresh(); // Refresh parent data
                    } catch (error) {
                        showToast('Failed to delete item', 'error');
                    }
                }
            };

            if (loading) {
                return (
                    <div className="loading">
                        <i className="fas fa-spinner"></i>
                        <p>Loading order details...</p>
                    </div>
                );
            }

            if (!order || !summary) {
                return <div className="error">Failed to load order details</div>;
            }

            return (
                <div>
                    <div className="form-group">
                        <label>Customer ID:</label>
                        <p>{order.customer_id}</p>
                    </div>
                    <div className="form-group">
                        <label>Order Date:</label>
                        <p>{new Date(order.order_date).toLocaleDateString()}</p>
                    </div>
                    <div className="form-group">
                        <label>Total Amount:</label>
                        <p>${order.total_amount.toFixed(2)}</p>
                    </div>
                    
                    <hr style={{margin: '20px 0'}} />
                    
                    <h4><i className="fas fa-list"></i> Order Items ({summary.summary.total_items})</h4>
                    <div style={{marginTop: '15px'}}>
                        {summary.items.length === 0 ? (
                            <p>No items in this order</p>
                        ) : (
                            summary.items.map(item => (
                                <div key={item.order_item_id} className="order-item-row">
                                    <div className="item-info">
                                        <div className="item-main">
                                            <strong>Product #{item.product_id}</strong>
                                        </div>
                                        <div className="item-details">
                                            {editingItem === item.order_item_id ? (
                                                <div className="edit-quantity">
                                                    <span>Qty: </span>
                                                    <input
                                                        type="number"
                                                        value={editQuantity}
                                                        onChange={(e) => setEditQuantity(e.target.value)}
                                                        min="1"
                                                        className="quantity-input"
                                                    />
                                                    <span> × ${item.unit_price.toFixed(2)}</span>
                                                </div>
                                            ) : (
                                                <span>Qty: {item.quantity} × ${item.unit_price.toFixed(2)}</span>
                                            )}
                                        </div>
                                    </div>
                                    <div className="item-actions">
                                        <div className="item-total">
                                            <strong>
                                                ${editingItem === item.order_item_id 
                                                    ? (editQuantity * item.unit_price).toFixed(2)
                                                    : item.line_total.toFixed(2)
                                                }
                                            </strong>
                                        </div>
                                        <div className="action-buttons">
                                            {editingItem === item.order_item_id ? (
                                                <>
                                                    <button 
                                                        className="btn btn-xs btn-success"
                                                        onClick={() => handleSaveEdit(item.order_item_id)}
                                                        title="Save"
                                                    >
                                                        <i className="fas fa-check"></i>
                                                    </button>
                                                    <button 
                                                        className="btn btn-xs btn-secondary"
                                                        onClick={handleCancelEdit}
                                                        title="Cancel"
                                                    >
                                                        <i className="fas fa-times"></i>
                                                    </button>
                                                </>
                                            ) : (
                                                <>
                                                    <button 
                                                        className="btn btn-xs btn-warning"
                                                        onClick={() => handleEditItem(item)}
                                                        title="Edit Quantity"
                                                    >
                                                        <i className="fas fa-edit"></i>
                                                    </button>
                                                    <button 
                                                        className="btn btn-xs btn-danger"
                                                        onClick={() => handleDeleteItem(item.order_item_id)}
                                                        title="Delete Item"
                                                    >
                                                        <i className="fas fa-trash"></i>
                                                    </button>
                                                </>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            ))
                        )}
                    </div>

                    <div className="form-buttons">
                        <button className="btn btn-secondary" onClick={onClose}>
                            Close
                        </button>
                    </div>
                </div>
            );
        };

        // Analytics Component
        const Analytics = ({ stats }) => {
            if (!stats) return <div className="loading">Loading analytics...</div>;

            return (
                <div className="analytics-grid">
                    <div className="analytics-card">
                        <h3><i className="fas fa-shopping-bag"></i> Top Products</h3>
                        <div className="product-stats">
                            {Object.entries(stats.product_stats)
                                .sort(([,a], [,b]) => b.revenue - a.revenue)
                                .slice(0, 10)
                                .map(([productId, data]) => (
                                    <div key={productId} className="product-stat">
                                        <div>
                                            <div><strong>Product #{productId}</strong></div>
                                            <div>Qty: {data.quantity}</div>
                                        </div>
                                        <div><strong>${data.revenue.toFixed(2)}</strong></div>
                                    </div>
                                ))
                            }
                        </div>
                    </div>

                    <div className="analytics-card">
                        <h3><i className="fas fa-calendar-alt"></i> Date Range</h3>
                        <div>
                            <p><strong>Earliest:</strong> {new Date(stats.date_range.earliest_order).toLocaleDateString()}</p>
                            <p><strong>Latest:</strong> {new Date(stats.date_range.latest_order).toLocaleDateString()}</p>
                            <p><strong>Customers:</strong> {stats.unique_customers}</p>
                            <p><strong>Products:</strong> {stats.unique_products}</p>
                        </div>
                    </div>
                </div>
            );
        };

        // Main App Component
        const App = () => {
            // State management
            const [activeTab, setActiveTab] = useState('orders');
            const [orders, setOrders] = useState([]);
            const [items, setItems] = useState([]);
            const [stats, setStats] = useState(null);
            const [loading, setLoading] = useState(false);
            
            // Modal states
            const [orderWithItemsModalOpen, setOrderWithItemsModalOpen] = useState(false);
            const [itemModalOpen, setItemModalOpen] = useState(false);
            const [detailsModalOpen, setDetailsModalOpen] = useState(false);
            const [selectedItem, setSelectedItem] = useState(null);
            const [selectedOrderId, setSelectedOrderId] = useState(null);
            
            // Toast states
            const [toast, setToast] = useState({ message: '', type: 'success', isVisible: false });

            // Load data functions
            const loadOrders = useCallback(async () => {
                try {
                    setLoading(true);
                    const data = await apiCall('/orders/');
                    setOrders(data);
                } catch (error) {
                    showToast('Failed to load orders', 'error');
                } finally {
                    setLoading(false);
                }
            }, []);

            const loadItems = useCallback(async () => {
                try {
                    setLoading(true);
                    const data = await apiCall('/order-items/');
                    setItems(data);
                } catch (error) {
                    showToast('Failed to load items', 'error');
                } finally {
                    setLoading(false);
                }
            }, []);

            const loadStats = useCallback(async () => {
                try {
                    const data = await apiCall('/stats');
                    setStats(data);
                } catch (error) {
                    showToast('Failed to load statistics', 'error');
                }
            }, []);

            // Toast helper
            const showToast = (message, type = 'success') => {
                setToast({ message, type, isVisible: true });
            };

            const hideToast = () => {
                setToast(prev => ({ ...prev, isVisible: false }));
            };

            // CRUD operations
            const handleCreateOrderWithItems = () => {
                setOrderWithItemsModalOpen(true);
            };

            const handleDeleteOrder = async (orderId) => {
                if (window.confirm(`Are you sure you want to delete Order #${orderId}?`)) {
                    try {
                        await apiCall(`/orders/${orderId}/`, { method: 'DELETE' });
                        showToast('Order deleted successfully!');
                        await Promise.all([loadOrders(), loadStats()]);
                    } catch (error) {
                        showToast('Failed to delete order', 'error');
                    }
                }
            };

            const handleSaveOrderWithItems = async (orderWithItemsData) => {
                try {
                    const response = await apiCall('/orders/with-items/', {
                        method: 'POST',
                        body: JSON.stringify(orderWithItemsData)
                    });
                    
                    const result = response;
                    showToast(`Order #${result.order_id} created successfully with ${orderWithItemsData.items.length} items! Total: $${result.total_amount.toFixed(2)}`);
                    
                    setOrderWithItemsModalOpen(false);
                    await Promise.all([loadOrders(), loadItems(), loadStats()]);
                } catch (error) {
                    console.error('Failed to create order with items:', error);
                    showToast('Failed to create order with items', 'error');
                }
            };

            const handleCreateItem = () => {
                setSelectedItem(null);
                setItemModalOpen(true);
            };

            const handleEditItem = (item) => {
                setSelectedItem(item);
                setItemModalOpen(true);
            };

            const handleSaveItem = async (itemData) => {
                try {
                    if (selectedItem) {
                        await apiCall(`/order-items/${selectedItem.order_item_id}`, {
                            method: 'PUT',
                            body: JSON.stringify(itemData)
                        });
                        showToast('Item updated successfully!');
                    } else {
                        await apiCall('/order-items/', {
                            method: 'POST',
                            body: JSON.stringify(itemData)
                        });
                        showToast('Item created successfully!');
                    }
                    
                    setItemModalOpen(false);
                    await Promise.all([loadItems(), loadOrders(), loadStats()]);
                } catch (error) {
                    showToast('Failed to save item', 'error');
                }
            };

            const handleDeleteItem = async (itemId) => {
                if (window.confirm(`Are you sure you want to delete Item #${itemId}?`)) {
                    try {
                        await apiCall(`/order-items/${itemId}`, { method: 'DELETE' });
                        showToast('Item deleted successfully!');
                        await Promise.all([loadItems(), loadOrders(), loadStats()]);
                    } catch (error) {
                        showToast('Failed to delete item', 'error');
                    }
                }
            };

            const handleViewOrderDetails = (orderId) => {
                setSelectedOrderId(orderId);
                setDetailsModalOpen(true);
            };

            const handleRefreshData = async () => {
                await Promise.all([loadOrders(), loadItems(), loadStats()]);
            };

            // Tab switching
            const handleTabChange = (tab) => {
                setActiveTab(tab);
                if (tab === 'analytics') {
                    loadStats();
                }
            };

            // Load initial data
            useEffect(() => {
                loadOrders();
                loadItems();
                loadStats();
            }, [loadOrders, loadItems, loadStats]);

            // Render content based on active tab
            const renderContent = () => {
                if (loading) {
                    return (
                        <div className="loading">
                            <i className="fas fa-spinner"></i>
                            <p>Loading...</p>
                        </div>
                    );
                }

                switch (activeTab) {
                    case 'orders':
                        return (
                            <>
                                <div className="section-header">
                                    <h2><i className="fas fa-receipt"></i> Orders Management</h2>
                                    <div className="header-actions">
                                        <button className="btn btn-primary" onClick={handleCreateOrderWithItems}>
                                            <i className="fas fa-plus"></i> New Order
                                        </button>
                                    </div>
                                </div>
                                <OrdersTable 
                                    orders={orders}
                                    onDelete={handleDeleteOrder}
                                    onViewDetails={handleViewOrderDetails}
                                />
                            </>
                        );
                    
                    case 'items':
                        return (
                            <>
                                <div className="section-header">
                                    <h2><i className="fas fa-list"></i> Order Items Management</h2>
                                    <button className="btn btn-primary" onClick={handleCreateItem}>
                                        <i className="fas fa-plus"></i> New Item
                                    </button>
                                </div>
                                <ItemsTable 
                                    items={items}
                                    onEdit={handleEditItem}
                                    onDelete={handleDeleteItem}
                                />
                            </>
                        );
                    
                    case 'analytics':
                        return (
                            <>
                                <div className="section-header">
                                    <h2><i className="fas fa-chart-bar"></i> Analytics Dashboard</h2>
                                    <button className="btn btn-secondary" onClick={loadStats}>
                                        <i className="fas fa-sync-alt"></i> Refresh
                                    </button>
                                </div>
                                <Analytics stats={stats} />
                            </>
                        );
                    
                    default:
                        return <div>Select a tab</div>;
                }
            };

            return (
                <div className="app-container">
                    {/* Header */}
                    <header className="app-header">
                        <h1><i className="fas fa-shopping-cart"></i> Iara's Orders Management System</h1>
                        <p className="subtitle">React Application</p>
                        
                        {stats && (
                            <div className="stats-bar">
                                <div className="stat-item">
                                    <span className="stat-label">Total Orders:</span>
                                    <span className="stat-value">{stats.total_orders}</span>
                                </div>
                                <div className="stat-item">
                                    <span className="stat-label">Total Revenue:</span>
                                    <span className="stat-value">${stats.total_revenue.toFixed(2)}</span>
                                </div>
                                <div className="stat-item">
                                    <span className="stat-label">Customers:</span>
                                    <span className="stat-value">{stats.unique_customers}</span>
                                </div>
                            </div>
                        )}
                    </header>

                    {/* Navigation */}
                    <nav className="tab-nav">
                        <button 
                            className={`tab-button ${activeTab === 'orders' ? 'active' : ''}`}
                            onClick={() => handleTabChange('orders')}
                        >
                            <i className="fas fa-receipt"></i> Orders
                        </button>
                        <button 
                            className={`tab-button ${activeTab === 'items' ? 'active' : ''}`}
                            onClick={() => handleTabChange('items')}
                        >
                            <i className="fas fa-list"></i> Order Items
                        </button>
                        <button 
                            className={`tab-button ${activeTab === 'analytics' ? 'active' : ''}`}
                            onClick={() => handleTabChange('analytics')}
                        >
                            <i className="fas fa-chart-bar"></i> Analytics
                        </button>
                    </nav>

                    {/* Content */}
                    <div className="content-area">
                        {renderContent()}
                    </div>

                    {/* Modals */}
                    <Modal 
                        isOpen={itemModalOpen} 
                        onClose={() => setItemModalOpen(false)}
                        title={selectedItem ? `Edit Item #${selectedItem.order_item_id}` : 'Create New Item'}
                    >
                        <ItemForm 
                            item={selectedItem}
                            onSave={handleSaveItem}
                            onCancel={() => setItemModalOpen(false)}
                        />
                    </Modal>

                    <Modal 
                        isOpen={detailsModalOpen} 
                        onClose={() => setDetailsModalOpen(false)}
                        title={`Order #${selectedOrderId} Details`}
                    >
                        {selectedOrderId && (
                            <OrderDetails 
                                orderId={selectedOrderId}
                                onClose={() => setDetailsModalOpen(false)}
                                showToast={showToast}
                                onRefresh={handleRefreshData}
                            />
                        )}
                    </Modal>

                    <Modal 
                        isOpen={orderWithItemsModalOpen} 
                        onClose={() => setOrderWithItemsModalOpen(false)}
                        title="Create New Order"
                    >
                        <OrderWithItemsForm 
                            onSave={handleSaveOrderWithItems}
                            onCancel={() => setOrderWithItemsModalOpen(false)}
                            showToast={showToast}
                        />
                    </Modal>

                    {/* Toast */}
                    <Toast 
                        message={toast.message}
                        type={toast.type}
                        isVisible={toast.isVisible}
                        onClose={hideToast}
                    />
                </div>
            );
        };

        // Render the App
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
